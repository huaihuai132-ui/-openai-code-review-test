<template>
  <div class="file-cabinet">
    <el-tabs v-model="activeTab" class="file-tabs">
      <!-- ‰∏™‰∫∫Êñá‰ª∂Êüú -->
      <el-tab-pane label="‰∏™‰∫∫Êñá‰ª∂Êüú" name="personal">
        <ContentWrap>
          <!-- Â∑•ÂÖ∑Ê†è -->
          <div class="toolbar">
            <div class="toolbar-left">
              <el-button type="primary" @click="handleUpload">
                <Icon icon="ep:upload" class="mr-5px" /> ‰∏ä‰º†Êñá‰ª∂
              </el-button>
              <el-button @click="refreshPersonalFiles">
                <Icon icon="ep:refresh" class="mr-5px" /> Âà∑Êñ∞
              </el-button>
              <el-button @click="toggleSelectMode" :type="isSelectMode ? 'primary' : ''">
                <Icon icon="ep:select" class="mr-5px" /> {{ isSelectMode ? 'ÂèñÊ∂àÈÄâÊã©' : 'ÊâπÈáèÈÄâÊã©' }}
              </el-button>
              <el-button @click="createFolder" v-if="false">
                <Icon icon="ep:folder-add" class="mr-5px" /> Êñ∞Âª∫Êñá‰ª∂Â§π
              </el-button>
            </div>
            <div class="toolbar-right">
              <!-- ÊêúÁ¥¢Ê°Ü -->
              <div class="search-container">
                <el-autocomplete v-model="searchKeyword" :fetch-suggestions="searchFiles" placeholder="ÊêúÁ¥¢Êñá‰ª∂..."
                  clearable @select="handleSearchSelect" @clear="handleSearchClear" class="search-input"
                  :trigger-on-focus="false">
                  <template #prefix>
                    <Icon icon="ep:search" class="search-icon" />
                  </template>
                  <template #default="{ item }">
                    <div class="search-item">
                      <div class="file-icon" style="font-size: 18px;">{{ getFileTypeIcon(item.name || '') }}</div>
                      <div class="file-info">
                        <div class="file-name">{{ item.name }}</div>
                        <div class="file-meta-row">
                          <span class="file-path">{{ item.dir || '/' }}</span>
                          <span class="file-size">{{ fileSizeFormatter(null, null, item.size) }}</span>
                          <span class="file-time">{{ dateFormatter(null, null, item.createTime) }}</span>
                        </div>
                      </div>
                    </div>
                  </template>
                </el-autocomplete>

                <!-- ÊéíÂ∫èÊåâÈíÆ -->
                <div class="sort-buttons">
                  <el-button @click="toggleSort('time')" :type="sortBy === 'time' ? 'primary' : ''" size="small"
                    :title="sortBy === 'time' && sortOrder === 'desc' ? 'ÊåâÊó∂Èó¥ÂçáÂ∫è' : 'ÊåâÊó∂Èó¥ÈôçÂ∫è'">
                    <Icon :icon="sortBy === 'time' && sortOrder === 'desc' ? 'ep:sort-down' : 'ep:sort-up'" />
                  </el-button>
                  <el-button @click="toggleSort('name')" :type="sortBy === 'name' ? 'primary' : ''" size="small"
                    :title="sortBy === 'name' && sortOrder === 'desc' ? 'ÊåâÊñá‰ª∂ÂêçÂçáÂ∫è' : 'ÊåâÊñá‰ª∂ÂêçÈôçÂ∫è'">
                    <Icon icon="ep:sort" />
                  </el-button>
                </div>

              </div>
            </div>
          </div>

          <!-- ÊâπÈáèÊìç‰ΩúÂ∑•ÂÖ∑Ê†è -->
          <div v-if="isSelectMode && selectedFiles.length > 0" class="bulk-actions-bar">
            <div class="selected-count">
              Â∑≤ÈÄâÊã© {{ selectedFiles.length }} ‰∏™Êñá‰ª∂
            </div>
            <div class="bulk-actions">
              <el-button @click="selectAll" size="small">
                <Icon icon="ep:check" class="mr-5px" /> ÂÖ®ÈÄâ
              </el-button>
              <el-button @click="clearSelection" size="small">
                <Icon icon="ep:close" class="mr-5px" /> Ê∏ÖÁ©∫ÈÄâÊã©
              </el-button>
              <el-button @click="bulkDownload" type="primary" size="small">
                <Icon icon="ep:download" class="mr-5px" /> ÊâπÈáè‰∏ãËΩΩ
              </el-button>
              <el-button @click="bulkMove" size="small">
                <Icon icon="ep:folder" class="mr-5px" /> ÊâπÈáèÁßªÂä®
              </el-button>
              <el-button @click="bulkSetPublic" size="small">
                <Icon icon="ep:unlock" class="mr-5px" /> ËÆæ‰∏∫ÂÖ¨ÂÖ±
              </el-button>
              <el-button @click="bulkDelete" type="danger" size="small">
                <Icon icon="ep:delete" class="mr-5px" /> ÊâπÈáèÂà†Èô§
              </el-button>
            </div>
          </div>

          <!-- Èù¢ÂåÖÂ±ëÂØºËà™ -->
          <div class="breadcrumb-nav">
            <el-breadcrumb separator="/">
              <el-breadcrumb-item @click="navigateToFolder('')" class="breadcrumb-item">
                <Icon icon="ep:home-filled" class="mr-5px" />
                Ê†πÁõÆÂΩï
              </el-breadcrumb-item>
              <el-breadcrumb-item v-for="(folder, index) in breadcrumbFolders" :key="index"
                @click="navigateToFolder(folder.path)" class="breadcrumb-item">
                {{ folder.name }}
              </el-breadcrumb-item>
            </el-breadcrumb>
          </div>

          <!-- Êñá‰ª∂ÁΩëÊ†ºËßÜÂõæ -->
          <div v-loading="personalLoading" class="file-grid">
            <!-- Êñá‰ª∂Â§π -->
            <div v-for="folder in currentFolders" :key="'folder-' + folder.name" class="file-card folder-card"
              @dblclick="navigateToFolder(folder.path)"
              @contextmenu.prevent="showContextMenu($event, folder, 'folder')">
              <div class="file-icon-container">
                <div class="folder-icon"
                  style="font-size: 96px !important; display: flex !important; width: 96px !important; height: 96px !important; align-items: center !important; justify-content: center !important; line-height: 1;">
                  üìÅ
                </div>
              </div>
              <div class="file-info">
                <div class="file-name" :title="folder.name">{{ folder.name }}</div>
                <div class="file-meta">Êñá‰ª∂Â§π</div>
              </div>
            </div>

            <!-- Êñá‰ª∂ -->
            <div v-for="(file, index) in currentFiles" :key="'file-' + file.id" class="file-card"
              :class="{ selected: isFileSelected(file) }" @click="handleFileClick(file, index, $event)"
              @dblclick="previewFile(file)" @contextmenu.prevent="showContextMenu($event, file, 'file')"
              @mounted="console.log('Êñá‰ª∂:', file.name, 'Á±ªÂûã:', file.type, 'ÈÖçÁΩÆID:', file.configId)">
              <div class="file-icon-container">
                <!-- ÈÄâÊã©Â§çÈÄâÊ°Ü -->
                <div v-if="isSelectMode" class="file-checkbox" @click.stop="toggleFileSelection(file)">
                  <el-checkbox :model-value="isFileSelected(file)" />
                </div>

                <el-image v-if="file.type && file.type.includes('image') && file.configId === 0" :src="file.url"
                  class="file-thumbnail" fit="cover" :preview-src-list="[file.url]" preview-teleported />
                <div v-else class="file-icon"
                  style="color: #409eff !important; font-size: 96px !important; display: flex !important; width: 96px !important; height: 96px !important; align-items: center !important; justify-content: center !important; line-height: 1;">
                  {{ getFileTypeIcon(file.name || '') }}
                </div>
              </div>
              <div class="file-info">
                <div class="file-name" :title="file.name">{{ file.name }}</div>
                <div class="file-meta">
                  <span>{{ fileSizeFormatter(null, null, file.size) }}</span>
                  <span class="file-date">{{ dateFormatter(null, null, file.createTime) }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Á©∫Áä∂ÊÄÅ -->
          <el-empty v-if="!personalLoading && currentFiles.length === 0 && currentFolders.length === 0"
            description="ÂΩìÂâçÊñá‰ª∂Â§π‰∏∫Á©∫" />
        </ContentWrap>
      </el-tab-pane>

      <!-- ÂÖ¨ÂÖ±Êñá‰ª∂Êüú -->
      <el-tab-pane label="ÂÖ¨ÂÖ±Êñá‰ª∂Êüú" name="public">
        <ContentWrap>
          <div class="toolbar">
            <el-button type="primary" @click="handlePublicUpload">
              <Icon icon="ep:upload" class="mr-5px" /> ‰∏ä‰º†ÂÖ¨ÂÖ±Êñá‰ª∂
            </el-button>
            <el-button @click="refreshPublicFiles">
              <Icon icon="ep:refresh" class="mr-5px" /> Âà∑Êñ∞
            </el-button>
          </div>

          <div v-loading="publicLoading" class="file-grid">
            <div v-for="file in publicFiles" :key="'public-' + file.id" class="file-card" @dblclick="previewFile(file)"
              @contextmenu.prevent="showContextMenu($event, file, 'public-file')">
              <div class="file-icon-container">
                <el-image v-if="file.type && file.type.includes('image') && file.configId === 0" :src="file.url"
                  class="file-thumbnail" fit="cover" :preview-src-list="[file.url]" preview-teleported />
                <div v-else class="file-icon"
                  style="color: #409eff !important; font-size: 96px !important; display: flex !important; width: 96px !important; height: 96px !important; align-items: center !important; justify-content: center !important; line-height: 1;">
                  {{ getFileTypeIcon(file.name || '') }}
                </div>
              </div>
              <div class="file-info">
                <div class="file-name" :title="file.name">{{ file.name }}</div>
                <div class="file-meta">
                  <span>{{ fileSizeFormatter(null, null, file.size) }}</span>
                  <span class="file-date">{{ dateFormatter(null, null, file.createTime) }}</span>
                </div>
              </div>
            </div>
          </div>

          <el-empty v-if="!publicLoading && publicFiles.length === 0" description="ÊöÇÊó†ÂÖ¨ÂÖ±Êñá‰ª∂" />
        </ContentWrap>
      </el-tab-pane>
    </el-tabs>

    <!-- Âè≥ÈîÆËèúÂçï -->
    <div v-show="contextMenuVisible" :style="{ left: contextMenuX + 'px', top: contextMenuY + 'px' }"
      class="context-menu" @click.stop>
      <div v-if="contextMenuType === 'file'" class="menu-items">
        <div class="menu-item" @click="previewFile(contextMenuTarget)">
          <Icon icon="ep:view" class="menu-icon" />
          È¢ÑËßà
        </div>
        <div class="menu-item" @click="downloadFile(contextMenuTarget)">
          <Icon icon="ep:download" class="menu-icon" />
          ‰∏ãËΩΩ
        </div>
        <div class="menu-item" @click="shareFile(contextMenuTarget)">
          <Icon icon="ep:share" class="menu-icon" />
          ÂàÜ‰∫´
        </div>
        <div class="menu-item" @click="showMoveDialog(contextMenuTarget)">
          <Icon icon="ep:folder" class="menu-icon" />
          ÁßªÂä®
        </div>
        <div class="menu-item" @click="showRenameDialog(contextMenuTarget)">
          <Icon icon="ep:edit-pen" class="menu-icon" />
          ÈáçÂëΩÂêç
        </div>
        <div class="menu-divider"></div>
        <div class="menu-item" @click="setFileAsPublic(contextMenuTarget)">
          <Icon icon="ep:unlock" class="menu-icon" />
          ËÆæ‰∏∫ÂÖ¨ÂÖ±
        </div>
        <div class="menu-item danger" @click="deleteFile(contextMenuTarget)">
          <Icon icon="ep:delete" class="menu-icon" />
          Âà†Èô§
        </div>
      </div>
      <div v-else-if="contextMenuType === 'folder'" class="menu-items">
        <div class="menu-item" @click="navigateToFolder(contextMenuTarget.path)">
          <Icon icon="ep:folder-opened" class="menu-icon" />
          ÊâìÂºÄ
        </div>
        <div class="menu-item" @click="showRenameFolderDialog(contextMenuTarget)">
          <Icon icon="ep:edit" class="menu-icon" />
          ÈáçÂëΩÂêç
        </div>
        <div class="menu-divider"></div>
        <div class="menu-item danger" @click="deleteFolder(contextMenuTarget)">
          <Icon icon="ep:delete" class="menu-icon" />
          Âà†Èô§Êñá‰ª∂Â§π
        </div>
      </div>
      <div v-else-if="contextMenuType === 'public-file'" class="menu-items">
        <div class="menu-item" @click="previewFile(contextMenuTarget)">
          <Icon icon="ep:view" class="menu-icon" />
          È¢ÑËßà
        </div>
        <div class="menu-item" @click="downloadFile(contextMenuTarget)">
          <Icon icon="ep:download" class="menu-icon" />
          ‰∏ãËΩΩ
        </div>
      </div>
    </div>

    <!-- ‰∏™‰∫∫Êñá‰ª∂‰∏ä‰º†ÂºπÁ™ó -->
    <el-dialog v-model="uploadVisible" title="‰∏ä‰º†Êñá‰ª∂" width="600px">
      <el-form :model="uploadForm" label-width="80px">
        <el-form-item label="‰∏ä‰º†ÁõÆÂΩï">
          <el-select v-model="uploadForm.targetDir" placeholder="ÈÄâÊã©‰∏ä‰º†ÁõÆÂΩïÊàñËæìÂÖ•Êñ∞ÁõÆÂΩï" filterable allow-create clearable
            style="width: 100%">
            <el-option label="Ê†πÁõÆÂΩï (/)" value="">
              <div class="folder-option">
                <Icon icon="ep:home-filled" class="folder-icon" />
                <span>Ê†πÁõÆÂΩï</span>
              </div>
            </el-option>
            <el-option v-for="folder in allFolders" :key="folder.path" :label="folder.path" :value="folder.path">
              <div class="folder-option">
                <Icon icon="ep:folder" class="folder-icon" />
                <span>{{ folder.path }}</span>
              </div>
            </el-option>
          </el-select>
        </el-form-item>
      </el-form>
      <UploadFile ref="uploadFileRef" v-model="uploadFileUrl" :drag="true"
        :file-type="['jpg', 'png', 'pdf', 'doc', 'docx', 'xls', 'xlsx', 'txt', 'zip', 'rar']" :file-size="50"
        :show-custom-file-name="true" :directory="'documents'" :dir="uploadForm.targetDir"
        @upload-success="handleUploadSuccess" @upload-error="handleUploadError" />
      <template #footer>
        <el-button @click="uploadVisible = false">ÂÖ≥Èó≠</el-button>
      </template>
    </el-dialog>

    <!-- ÂÖ¨ÂÖ±Êñá‰ª∂‰∏ä‰º†ÂºπÁ™ó -->
    <el-dialog v-model="publicUploadVisible" title="‰∏ä‰º†ÂÖ¨ÂÖ±Êñá‰ª∂" width="600px">
      <UploadFile ref="publicUploadRef" v-model="publicUploadFileUrl" :drag="true"
        :file-type="['jpg', 'png', 'pdf', 'doc', 'docx', 'xls', 'xlsx', 'txt', 'zip', 'rar']" :file-size="50"
        :show-custom-file-name="true" directory="public" @upload-success="handlePublicUploadSuccess"
        @upload-error="handlePublicUploadError" />
      <template #footer>
        <el-button @click="publicUploadVisible = false">ÂÖ≥Èó≠</el-button>
      </template>
    </el-dialog>

    <!-- Êñá‰ª∂ÂàÜ‰∫´ÂºπÁ™ó -->
    <el-dialog v-model="shareVisible" title="ÂàÜ‰∫´Êñá‰ª∂" width="400px">
      <el-form :model="shareForm" label-width="80px">
        <el-form-item label="Áî®Êà∑ID">
          <el-input v-model="shareForm.userId" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑ID" />
        </el-form-item>
        <el-form-item label="ÊùÉÈôêÁ±ªÂûã">
          <el-select v-model="shareForm.permission" placeholder="ËØ∑ÈÄâÊã©ÊùÉÈôê">
            <el-option label="Âè™ËØª" :value="1" />
            <el-option label="ÂèØÂÜô" :value="2" />
          </el-select>
        </el-form-item>
        <el-form-item label="Âà∞ÊúüÊó∂Èó¥">
          <el-date-picker v-model="shareForm.expiredTime" type="datetime" placeholder="ÈÄâÊã©Âà∞ÊúüÊó∂Èó¥ÔºåÁïôÁ©∫Ë°®Á§∫Ê∞∏‰πÖÊúâÊïà"
            format="YYYY-MM-DD HH:mm:ss" value-format="YYYY-MM-DD HH:mm:ss" clearable />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="shareVisible = false">ÂèñÊ∂à</el-button>
        <el-button type="primary" @click="confirmShare">Á°ÆËÆ§ÂàÜ‰∫´</el-button>
      </template>
    </el-dialog>

    <!-- ÁßªÂä®Êñá‰ª∂ÂºπÁ™ó -->
    <el-dialog v-model="moveDialogVisible" title="ÁßªÂä®Êñá‰ª∂Âà∞ÁõÆÂΩï" width="500px">
      <el-form :model="moveForm" label-width="80px">
        <el-form-item label="ÁõÆÊ†áÁõÆÂΩï">
          <el-select v-model="moveForm.targetDir" placeholder="ÈÄâÊã©ÁõÆÊ†áÁõÆÂΩïÊàñËæìÂÖ•Êñ∞ÁõÆÂΩï" filterable allow-create clearable
            style="width: 100%">
            <el-option label="Ê†πÁõÆÂΩï (/)" value="">
              <div class="folder-option">
                <Icon icon="ep:home-filled" class="folder-icon" />
                <span>Ê†πÁõÆÂΩï</span>
              </div>
            </el-option>
            <el-option v-for="folder in allFolders" :key="folder.path" :label="folder.path" :value="folder.path">
              <div class="folder-option">
                <Icon icon="ep:folder" class="folder-icon" />
                <span>{{ folder.path }}</span>
              </div>
            </el-option>
          </el-select>
        </el-form-item>
        <el-form-item>
          <div class="move-tips">
            <Icon icon="ep:info-filled" class="tip-icon" />
            <span>ÂèØ‰ª•ÈÄâÊã©Áé∞ÊúâÁõÆÂΩïÔºå‰πüÂèØ‰ª•ËæìÂÖ•Êñ∞ÁöÑÁõÆÂΩïË∑ØÂæÑ</span>
          </div>
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="moveDialogVisible = false">ÂèñÊ∂à</el-button>
        <el-button type="primary" @click="confirmMove">Á°ÆËÆ§ÁßªÂä®</el-button>
      </template>
    </el-dialog>

    <!-- ÈáçÂëΩÂêçÊñá‰ª∂ÂºπÁ™ó -->
    <el-dialog v-model="renameDialogVisible" title="ÈáçÂëΩÂêçÊñá‰ª∂" width="450px" @opened="focusFileNameInput">
      <el-form :model="renameForm" label-width="80px">
        <el-form-item label="Êñá‰ª∂Âêç">
          <el-row :gutter="8">
            <el-col :span="16">
              <el-input ref="fileNameInputRef" v-model="renameForm.fileName" placeholder="ËØ∑ËæìÂÖ•Êñá‰ª∂Âêç"
                @keyup.enter="confirmRename" />
            </el-col>
            <el-col :span="8">
              <el-input v-model="renameForm.fileExtension" placeholder="Êâ©Â±ïÂêç" @keyup.enter="confirmRename">
                <template #prepend>.</template>
              </el-input>
            </el-col>
          </el-row>
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="renameDialogVisible = false">ÂèñÊ∂à</el-button>
        <el-button type="primary" @click="confirmRename" :disabled="!renameForm.fileName.trim()">Á°ÆËÆ§ÈáçÂëΩÂêç</el-button>
      </template>
    </el-dialog>


  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, computed, nextTick } from 'vue'
import { UploadFile } from '@/components/UploadFile'
import { fileSizeFormatter } from '@/utils'
import { dateFormatter } from '@/utils/formatTime'
import * as FileApi from '@/api/infra/file/index'
import { useUserStore } from '@/store/modules/user'
import { useMessage } from '@/hooks/web/useMessage'

defineOptions({ name: 'FileCabinet' })

const message = useMessage()
const userStore = useUserStore()

// Âõ∫ÂÆöÂüüÂêçÈÖçÁΩÆ
const FIXED_DOMAIN = 'http://182.109.52.126:49090'

// Base64ÁºñÁ†ÅÂáΩÊï∞
const base64Encode = (str: string) => {
  return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (match, p1) => {
    return String.fromCharCode(parseInt(p1, 16))
  }))
}

// Ê†áÁ≠æÈ°µ
const activeTab = ref('personal')

// ‰∏™‰∫∫Êñá‰ª∂
const personalLoading = ref(false)
const personalFiles = ref<any[]>([])

// ÂÖ¨ÂÖ±Êñá‰ª∂
const publicLoading = ref(false)
const publicFiles = ref<any[]>([])

// ÂΩìÂâçË∑ØÂæÑÂíåÊñá‰ª∂Â§πÁªìÊûÑ
const currentPath = ref('')
const allFolders = ref<any[]>([])

// ÊêúÁ¥¢Áõ∏ÂÖ≥
const searchKeyword = ref('')
const searchResults = ref<any[]>([])

// Âè≥ÈîÆËèúÂçï
const contextMenuVisible = ref(false)
const contextMenuX = ref(0)
const contextMenuY = ref(0)
const contextMenuTarget = ref<any>(null)
const contextMenuType = ref('')

// ÁßªÂä®Êñá‰ª∂ÂºπÁ™ó
const moveDialogVisible = ref(false)
const moveFileTarget = ref<any>(null)
const moveForm = ref({
  targetDir: ''
})

// ÈáçÂëΩÂêçÊñá‰ª∂ÂºπÁ™ó
const renameDialogVisible = ref(false)
const renameFileTarget = ref<any>(null)
const renameForm = ref({
  fileName: '',
  fileExtension: ''
})
const fileNameInputRef = ref()





// ÊâπÈáèÊìç‰Ωú
const selectedFiles = ref<any[]>([])
const isSelectMode = ref(false)

// ÊéíÂ∫èÁõ∏ÂÖ≥
const sortBy = ref('time') // 'time' | 'name'
const sortOrder = ref('desc') // 'asc' | 'desc'

// Âø´Êç∑ÈîÆÁä∂ÊÄÅ
const isCtrlPressed = ref(false)
const isShiftPressed = ref(false)
const lastSelectedIndex = ref(-1)

// ‰∏™‰∫∫Êñá‰ª∂‰∏ä‰º†
const uploadVisible = ref(false)
const uploadFileUrl = ref('')
const uploadForm = ref({
  targetDir: ''
})
const uploadFileRef = ref()

// ÂÖ¨ÂÖ±Êñá‰ª∂‰∏ä‰º†
const publicUploadVisible = ref(false)
const publicUploadFileUrl = ref('')
const publicUploadRef = ref()

// Êñá‰ª∂ÂàÜ‰∫´
const shareVisible = ref(false)
const shareForm = ref({
  fileId: 0,
  userId: '',
  permission: 1,
  expiredTime: ''
})

// ËÆ°ÁÆóÂ±ûÊÄßÔºöÈù¢ÂåÖÂ±ëÂØºËà™
const breadcrumbFolders = computed(() => {
  if (!currentPath.value) return []
  const parts = currentPath.value.split('/').filter(Boolean)
  const folders: any[] = []
  let path = ''

  parts.forEach(part => {
    path += (path ? '/' : '') + part
    folders.push({
      name: part,
      path: path
    })
  })

  return folders
})

// ËÆ°ÁÆóÂ±ûÊÄßÔºöÂΩìÂâçÊñá‰ª∂Â§π‰∏ãÁöÑÊñá‰ª∂Â§π
const currentFolders = computed(() => {
  const folders = new Set<string>()

  personalFiles.value.forEach(file => {
    const fileDir = file.dir || ''

    // Â¶ÇÊûúÂΩìÂâçÂú®Ê†πÁõÆÂΩï
    if (!currentPath.value) {
      if (fileDir && !fileDir.startsWith('/')) {
        const firstFolder = fileDir.split('/')[0]
        if (firstFolder) {
          folders.add(firstFolder)
        }
      }
    } else {
      // Â¶ÇÊûúÂΩìÂâçÂú®Â≠êÁõÆÂΩï
      if (fileDir.startsWith(currentPath.value + '/')) {
        const relativePath = fileDir.substring(currentPath.value.length + 1)
        const firstFolder = relativePath.split('/')[0]
        if (firstFolder) {
          folders.add(firstFolder)
        }
      }
    }
  })

  return Array.from(folders).map(name => ({
    name,
    path: currentPath.value ? `${currentPath.value}/${name}` : name
  }))
})

// ËÆ°ÁÆóÂ±ûÊÄßÔºöÂΩìÂâçÊñá‰ª∂Â§π‰∏ãÁöÑÊñá‰ª∂
const currentFiles = computed(() => {
  let files = personalFiles.value.filter(file => {
    const fileDir = file.dir || ''

    // Â¶ÇÊûúÂΩìÂâçÂú®Ê†πÁõÆÂΩïÔºåÊòæÁ§∫dir‰∏∫Á©∫ÊàñËÄÖ‰∏∫'/'ÁöÑÊñá‰ª∂
    if (!currentPath.value) {
      return !fileDir || fileDir === '/' || fileDir === ''
    }

    // Â¶ÇÊûúÂΩìÂâçÂú®Â≠êÁõÆÂΩïÔºåÊòæÁ§∫dirÂÆåÂÖ®ÂåπÈÖçÂΩìÂâçË∑ØÂæÑÁöÑÊñá‰ª∂
    return fileDir === currentPath.value
  })

  // ÊéíÂ∫èÈÄªËæë
  return files.sort((a, b) => {
    if (sortBy.value === 'time') {
      const timeA = new Date(a.createTime).getTime()
      const timeB = new Date(b.createTime).getTime()
      return sortOrder.value === 'desc' ? timeB - timeA : timeA - timeB
    } else if (sortBy.value === 'name') {
      const nameA = a.name.toLowerCase()
      const nameB = b.name.toLowerCase()
      if (sortOrder.value === 'desc') {
        return nameB.localeCompare(nameA)
      } else {
        return nameA.localeCompare(nameB)
      }
    }
    return 0
  })
})

// Ëé∑Âèñ‰∏™‰∫∫Êñá‰ª∂ÂàóË°®
const getPersonalFiles = async () => {
  personalLoading.value = true
  try {
    const response = await FileApi.getUserVisibleFiles()

    // Â§ÑÁêÜAPIÂìçÂ∫îÔºöÊ£ÄÊü•ÊòØÂê¶Áõ¥Êé•ËøîÂõûÊï∞ÁªÑËøòÊòØÊ†áÂáÜÊ†ºÂºè
    if (Array.isArray(response)) {
      personalFiles.value = response
    } else if (response && response.code === 0 && response.data) {
      personalFiles.value = response.data
    } else {
      personalFiles.value = []
    }

    // ÊûÑÂª∫ÊâÄÊúâÊñá‰ª∂Â§πÂàóË°®
    buildAllFolders()
  } catch (error) {
    console.error('Ëé∑Âèñ‰∏™‰∫∫Êñá‰ª∂Â§±Ë¥•:', error)
    message.error('Ëé∑Âèñ‰∏™‰∫∫Êñá‰ª∂Â§±Ë¥•')
    personalFiles.value = []
  } finally {
    personalLoading.value = false
  }
}

// ÊûÑÂª∫ÊâÄÊúâÊñá‰ª∂Â§πÂàóË°®
const buildAllFolders = () => {
  const folders = new Set<string>()

  personalFiles.value.forEach(file => {
    const fileDir = file.dir || ''
    if (fileDir && fileDir !== '/') {
      // Ê∑ªÂä†ÊâÄÊúâÂ±ÇÁ∫ßÁöÑÊñá‰ª∂Â§π
      const parts = fileDir.split('/').filter(Boolean)
      let path = ''
      parts.forEach(part => {
        path += (path ? '/' : '') + part
        folders.add(path)
      })
    }
  })

  allFolders.value = Array.from(folders).map(path => ({
    name: path.split('/').pop() || path,
    path: path
  }))
}

// Ëé∑ÂèñÂÖ¨ÂÖ±Êñá‰ª∂ÂàóË°®
const getPublicFiles = async () => {
  publicLoading.value = true
  try {
    const response = await FileApi.getPublicFiles()

    // Â§ÑÁêÜAPIÂìçÂ∫îÔºöÊ£ÄÊü•ÊòØÂê¶Áõ¥Êé•ËøîÂõûÊï∞ÁªÑËøòÊòØÊ†áÂáÜÊ†ºÂºè
    if (Array.isArray(response)) {
      publicFiles.value = response
    } else if (response && response.code === 0 && response.data) {
      publicFiles.value = response.data
    } else {
      publicFiles.value = []
    }
  } catch (error) {
    console.error('Ëé∑ÂèñÂÖ¨ÂÖ±Êñá‰ª∂Â§±Ë¥•:', error)
    message.error('Ëé∑ÂèñÂÖ¨ÂÖ±Êñá‰ª∂Â§±Ë¥•')
    publicFiles.value = []
  } finally {
    publicLoading.value = false
  }
}

// ÂØºËà™Âà∞ÊåáÂÆöÊñá‰ª∂Â§π
const navigateToFolder = (path: string) => {
  currentPath.value = path
  hideContextMenu()
}

// ÊêúÁ¥¢Êñá‰ª∂
const searchFiles = (queryString: string, callback: Function) => {
  if (!queryString) {
    callback([])
    return
  }

  // Âú®Â∑≤ÊúâÁöÑÊñá‰ª∂ÂàóË°®‰∏≠ÊêúÁ¥¢
  const results = personalFiles.value.filter(file => {
    return file.name.toLowerCase().includes(queryString.toLowerCase())
  }).map(file => ({
    ...file,
    value: file.name, // Áî®‰∫éautocompleteÊòæÁ§∫
    label: file.name  // Áî®‰∫éautocompleteÊòæÁ§∫
  }))

  callback(results)
}



// Â§ÑÁêÜÊêúÁ¥¢ÈÄâÊã©
const handleSearchSelect = (item: any) => {
  // Ë∑≥ËΩ¨Âà∞Êñá‰ª∂ÊâÄÂú®ÁõÆÂΩï
  if (item.dir) {
    navigateToFolder(item.dir)
  }
  // Ê∏ÖÁ©∫ÊêúÁ¥¢Ê°Ü
  searchKeyword.value = ''
}

// Ê∏ÖÁ©∫ÊêúÁ¥¢
const handleSearchClear = () => {
  searchResults.value = []
}

// ÊòæÁ§∫Âè≥ÈîÆËèúÂçï
const showContextMenu = (event: MouseEvent, target: any, type: string) => {
  event.preventDefault()
  contextMenuTarget.value = target
  contextMenuType.value = type
  contextMenuX.value = event.clientX
  contextMenuY.value = event.clientY
  contextMenuVisible.value = true

  // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÈöêËóèËèúÂçï
  nextTick(() => {
    document.addEventListener('click', hideContextMenu)
  })
}

// ÈöêËóèÂè≥ÈîÆËèúÂçï
const hideContextMenu = () => {
  contextMenuVisible.value = false
  document.removeEventListener('click', hideContextMenu)
}

// Ëé∑ÂèñÊñá‰ª∂ÂõæÊ†áÂíåÈ¢úËâ≤
const getFileIcon = (type: string) => {
  // Â¶ÇÊûúÊ≤°ÊúâÁ±ªÂûãÊàñÁ±ªÂûã‰∏∫Á©∫ÔºåËøîÂõûÈªòËÆ§ÊñáÊ°£ÂõæÊ†á
  if (!type || type.trim() === '' || type === null || type === undefined) {
    return { icon: 'ep:document', color: '#718096' }
  }

  const lowerType = type.toLowerCase().trim()

  // ÂõæÁâáÊñá‰ª∂
  if (lowerType.includes('image') ||
    /\.(jpg|jpeg|png|gif|webp|svg|bmp|ico|tiff|tif)$/i.test(lowerType)) {
    if (lowerType.includes('svg')) {
      return { icon: 'ep:picture', color: '#FF6B35' }
    }
    return { icon: 'ep:picture', color: '#67C23A' }
  }

  // PDFÊñá‰ª∂
  if (lowerType.includes('pdf') || lowerType.endsWith('.pdf')) {
    return { icon: 'ep:document', color: '#E53E3E' }
  }

  // Microsoft Office ÊñáÊ°£
  if (lowerType.includes('word') || /\.(doc|docx)$/i.test(lowerType)) {
    return { icon: 'ep:edit-pen', color: '#2B579A' }
  }

  if (lowerType.includes('excel') || lowerType.includes('sheet') ||
    /\.(xlsx|xls|xlsm|xlsb)$/i.test(lowerType)) {
    return { icon: 'ep:data-analysis', color: '#217346' }
  }

  if (lowerType.includes('powerpoint') || lowerType.includes('presentation') ||
    /\.(ppt|pptx|pps|ppsx)$/i.test(lowerType)) {
    return { icon: 'ep:monitor', color: '#D24726' }
  }

  // Google Docs Á≥ªÂàó
  if (lowerType.includes('google') && lowerType.includes('doc')) {
    return { icon: 'ep:edit-pen', color: '#4285F4' }
  }
  if (lowerType.includes('google') && lowerType.includes('sheet')) {
    return { icon: 'ep:data-analysis', color: '#34A853' }
  }
  if (lowerType.includes('google') && lowerType.includes('slide')) {
    return { icon: 'ep:monitor', color: '#FBBC04' }
  }

  // Êï∞ÊçÆÊñá‰ª∂
  if (/\.(csv|tsv|dat)$/i.test(lowerType)) {
    return { icon: 'ep:data-board', color: '#38A169' }
  }

  // ÊñáÊú¨ÂíåÊ†áËÆ∞ËØ≠Ë®ÄÊñá‰ª∂
  if (lowerType.includes('text') || /\.(txt|rtf)$/i.test(lowerType)) {
    return { icon: 'ep:document-copy', color: '#718096' }
  }

  if (/\.(md|markdown)$/i.test(lowerType)) {
    return { icon: 'ep:edit', color: '#319795' }
  }

  if (/\.(log|logs)$/i.test(lowerType)) {
    return { icon: 'ep:document-checked', color: '#A0AEC0' }
  }

  // ÂéãÁº©Êñá‰ª∂
  if (/\.(zip|rar|7z|tar|gz|bz2|xz|dmg|iso)$/i.test(lowerType)) {
    return { icon: 'ep:files', color: '#D69E2E' }
  }

  // ËßÜÈ¢ëÊñá‰ª∂
  if (lowerType.includes('video') ||
    /\.(mp4|avi|mov|wmv|flv|mkv|webm|m4v|3gp|f4v|asf|rm|rmvb)$/i.test(lowerType)) {
    return { icon: 'ep:video-play', color: '#E53E3E' }
  }

  // Èü≥È¢ëÊñá‰ª∂
  if (lowerType.includes('audio') ||
    /\.(mp3|wav|flac|aac|ogg|wma|m4a|opus|ape|ac3|amr)$/i.test(lowerType)) {
    return { icon: 'ep:headphones', color: '#3182CE' }
  }

  // ‰ª£Á†ÅÊñá‰ª∂
  if (/\.(js|jsx|ts|tsx)$/i.test(lowerType)) {
    return { icon: 'ep:document-checked', color: '#F7DF1E' }
  }

  if (/\.(html|htm|xhtml)$/i.test(lowerType)) {
    return { icon: 'ep:document-checked', color: '#E34F26' }
  }

  if (/\.(css|scss|sass|less|stylus)$/i.test(lowerType)) {
    return { icon: 'ep:document-checked', color: '#1572B6' }
  }

  if (/\.(json|xml|yml|yaml|toml)$/i.test(lowerType)) {
    return { icon: 'ep:data-line', color: '#805AD5' }
  }

  if (/\.(py|python)$/i.test(lowerType)) {
    return { icon: 'ep:document-checked', color: '#3776AB' }
  }

  if (/\.(java|jar)$/i.test(lowerType)) {
    return { icon: 'ep:document-checked', color: '#ED8B00' }
  }

  if (/\.(php|php3|php4|php5|phtml)$/i.test(lowerType)) {
    return { icon: 'ep:document-checked', color: '#777BB4' }
  }

  if (/\.(cpp|c\+\+|cc|cxx|c)$/i.test(lowerType)) {
    return { icon: 'ep:document-checked', color: '#00599C' }
  }

  if (/\.(sql|mysql|postgresql|sqlite)$/i.test(lowerType)) {
    return { icon: 'ep:coin', color: '#336791' }
  }

  if (/\.(sh|bash|zsh|fish|bat|cmd|ps1)$/i.test(lowerType)) {
    return { icon: 'ep:operation', color: '#4EAA25' }
  }

  // ËÆæËÆ°Êñá‰ª∂
  if (/\.(psd|ai|sketch|xd|figma)$/i.test(lowerType)) {
    return { icon: 'ep:brush', color: '#FF61F6' }
  }

  // CAD Êñá‰ª∂
  if (/\.(dwg|dxf|step|iges|stl)$/i.test(lowerType)) {
    return { icon: 'ep:setting', color: '#FF8C00' }
  }

  // ÁîµÂ≠ê‰π¶
  if (/\.(epub|mobi|azw|azw3|fb2)$/i.test(lowerType)) {
    return { icon: 'ep:reading', color: '#8B4513' }
  }

  // Â≠ó‰ΩìÊñá‰ª∂
  if (/\.(ttf|otf|woff|woff2|eot)$/i.test(lowerType)) {
    return { icon: 'ep:postcard', color: '#2D3748' }
  }

  // ÂèØÊâßË°åÊñá‰ª∂
  if (/\.(exe|msi|dmg|deb|rpm|appimage|app)$/i.test(lowerType)) {
    return { icon: 'ep:cpu', color: '#2D3748' }
  }

  // ÈÖçÁΩÆÊñá‰ª∂
  if (/\.(ini|conf|config|cfg|env)$/i.test(lowerType)) {
    return { icon: 'ep:tools', color: '#4A5568' }
  }

  // ÂÖ∂‰ªñÂ∏∏ËßÅÊñá‰ª∂Á±ªÂûã
  if (lowerType.includes('certificate') || /\.(crt|pem|p12|pfx)$/i.test(lowerType)) {
    return { icon: 'ep:lock', color: '#38A169' }
  }

  // ÈªòËÆ§ÊñáÊ°£ - Á°Æ‰øùÊúâÂõæÊ†áÊòæÁ§∫
  return { icon: 'ep:document', color: '#718096' }
}

// Á°Æ‰øùËé∑ÂèñÂõæÊ†áÂáΩÊï∞Ê∞∏Ëøú‰∏ç‰ºöËøîÂõûÁ©∫ÂÄº
const getSafeFileIcon = (type: string) => {
  try {
    const result = getFileIcon(type)
    if (!result || !result.icon) {
      return { icon: 'ep:document', color: '#718096' }
    }
    return result
  } catch (error) {
    console.warn('Ëé∑ÂèñÊñá‰ª∂ÂõæÊ†áÂ§±Ë¥•:', error, 'type:', type)
    return { icon: 'ep:document', color: '#718096' }
  }
}

// Ê†πÊçÆÊñá‰ª∂ÂêçËé∑ÂèñÂØπÂ∫îÁöÑemojiÂõæÊ†á
const getFileTypeIcon = (fileName: string) => {
  if (!fileName) return 'üìÑ'

  const extension = fileName.toLowerCase().split('.').pop() || ''

  // ÂõæÁâáÊñá‰ª∂
  if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'bmp', 'ico', 'tiff', 'tif'].includes(extension)) {
    return 'üñºÔ∏è'
  }

  // PDFÊñá‰ª∂
  if (extension === 'pdf') {
    return 'üìï'
  }

  // WordÊñáÊ°£
  if (['doc', 'docx'].includes(extension)) {
    return 'üìò'
  }

  // ExcelÊñáÊ°£
  if (['xls', 'xlsx', 'xlsm', 'xlsb'].includes(extension)) {
    return 'üìó'
  }

  // PowerPointÊñáÊ°£
  if (['ppt', 'pptx', 'pps', 'ppsx'].includes(extension)) {
    return 'üìô'
  }

  // ÂéãÁº©Êñá‰ª∂
  if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2', 'xz'].includes(extension)) {
    return 'üóúÔ∏è'
  }

  // ËßÜÈ¢ëÊñá‰ª∂
  if (['mp4', 'avi', 'mov', 'wmv', 'flv', 'mkv', 'webm', 'm4v', '3gp'].includes(extension)) {
    return 'üé¨'
  }

  // Èü≥È¢ëÊñá‰ª∂
  if (['mp3', 'wav', 'flac', 'aac', 'ogg', 'wma', 'm4a', 'opus'].includes(extension)) {
    return 'üéµ'
  }

  // ‰ª£Á†ÅÊñá‰ª∂
  if (['js', 'jsx', 'ts', 'tsx', 'html', 'css', 'php', 'py', 'java', 'cpp', 'c', 'go', 'rs'].includes(extension)) {
    return 'üíª'
  }

  // ÊñáÊú¨Êñá‰ª∂
  if (['txt', 'md', 'log', 'rtf'].includes(extension)) {
    return 'üìù'
  }

  // Êï∞ÊçÆÊñá‰ª∂
  if (['json', 'xml', 'csv', 'sql', 'yaml', 'yml'].includes(extension)) {
    return 'üìä'
  }

  // Â≠ó‰ΩìÊñá‰ª∂
  if (['ttf', 'otf', 'woff', 'woff2', 'eot'].includes(extension)) {
    return 'üî§'
  }

  // ÂèØÊâßË°åÊñá‰ª∂
  if (['exe', 'msi', 'dmg', 'deb', 'rpm', 'app'].includes(extension)) {
    return '‚öôÔ∏è'
  }

  // ÈªòËÆ§ÊñáÊ°£ÂõæÊ†á
  return 'üìÑ'
}

// Âà∑Êñ∞‰∏™‰∫∫Êñá‰ª∂
const refreshPersonalFiles = () => {
  getPersonalFiles()
}

// Âà∑Êñ∞ÂÖ¨ÂÖ±Êñá‰ª∂
const refreshPublicFiles = () => {
  getPublicFiles()
}

// ÂàáÊç¢ÊéíÂ∫èÊñπÂºè
const toggleSort = (type: 'time' | 'name') => {
  if (sortBy.value === type) {
    // Â¶ÇÊûúÊòØÂêå‰∏ÄÁßçÊéíÂ∫èÊñπÂºèÔºåÂàáÊç¢ÂçáÂ∫è/ÈôçÂ∫è
    sortOrder.value = sortOrder.value === 'desc' ? 'asc' : 'desc'
  } else {
    // Â¶ÇÊûúÊòØ‰∏çÂêåÊéíÂ∫èÊñπÂºèÔºåËÆæÁΩÆ‰∏∫Êñ∞ÁöÑÊéíÂ∫èÊñπÂºèÔºåÈªòËÆ§ÈôçÂ∫è
    sortBy.value = type
    sortOrder.value = 'desc'
  }
}

// Ëé∑ÂèñÈùôÊÄÅÂõæÁâáURL
// const getStaticImageUrl = (path: string) => {
//   if (!path) return ''
//   // ÊãºÊé•minioÈùôÊÄÅÊ°∂Âú∞ÂùÄ
//   return `http://182.109.52.126:49090/minio/static/${path}`
// }

// Â§ÑÁêÜ‰∏™‰∫∫Êñá‰ª∂‰∏ä‰º†
const handleUpload = () => {
  uploadForm.value.targetDir = currentPath.value
  uploadVisible.value = true
}

// ÊòæÁ§∫ÁßªÂä®Êñá‰ª∂ÂØπËØùÊ°Ü
const showMoveDialog = (file: any) => {
  moveFileTarget.value = file
  moveForm.value.targetDir = ''
  moveDialogVisible.value = true
  hideContextMenu()
}

// Á°ÆËÆ§ÁßªÂä®Êñá‰ª∂
const confirmMove = async () => {
  if (!moveFileTarget.value) return

  try {
    await FileApi.moveFile(moveFileTarget.value.id, moveForm.value.targetDir)
    message.success('Êñá‰ª∂ÁßªÂä®ÊàêÂäüÔºÅ')
    moveDialogVisible.value = false
    refreshPersonalFiles()
  } catch (error) {
    console.error('ÁßªÂä®Êñá‰ª∂Â§±Ë¥•:', error)
    message.error('ÁßªÂä®Êñá‰ª∂Â§±Ë¥•')
  }
}

// ÊòæÁ§∫ÈáçÂëΩÂêçÊñá‰ª∂ÂØπËØùÊ°Ü
const showRenameDialog = (file: any) => {
  renameFileTarget.value = file

  // ÂàÜÁ¶ªÊñá‰ª∂ÂêçÂíåÊâ©Â±ïÂêç
  const fileName = file.name
  const lastDotIndex = fileName.lastIndexOf('.')

  if (lastDotIndex > 0 && lastDotIndex < fileName.length - 1) {
    // ÊúâÊâ©Â±ïÂêçÁöÑÊÉÖÂÜµ
    renameForm.value.fileName = fileName.substring(0, lastDotIndex)
    renameForm.value.fileExtension = fileName.substring(lastDotIndex + 1)
  } else {
    // Ê≤°ÊúâÊâ©Â±ïÂêçÁöÑÊÉÖÂÜµ
    renameForm.value.fileName = fileName
    renameForm.value.fileExtension = ''
  }

  renameDialogVisible.value = true
  hideContextMenu()
}

// Á°ÆËÆ§ÈáçÂëΩÂêçÊñá‰ª∂
const confirmRename = async () => {
  if (!renameFileTarget.value || !renameForm.value.fileName.trim()) {
    message.error('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊñá‰ª∂Âêç')
    return
  }

  // ÊûÑÂª∫ÂÆåÊï¥Êñá‰ª∂Âêç
  const newFileName = renameForm.value.fileExtension.trim()
    ? `${renameForm.value.fileName.trim()}.${renameForm.value.fileExtension.trim()}`
    : renameForm.value.fileName.trim()

  try {
    await FileApi.renameFile(renameFileTarget.value.id, newFileName)
    message.success('Êñá‰ª∂ÈáçÂëΩÂêçÊàêÂäüÔºÅ')
    renameDialogVisible.value = false
    refreshPersonalFiles()
  } catch (error) {
    console.error('ÈáçÂëΩÂêçÊñá‰ª∂Â§±Ë¥•:', error)
    message.error('ÈáçÂëΩÂêçÊñá‰ª∂Â§±Ë¥•')
  }
}



// ËÅöÁÑ¶Êñá‰ª∂ÂêçËæìÂÖ•Ê°Ü
const focusFileNameInput = () => {
  nextTick(() => {
    if (fileNameInputRef.value) {
      fileNameInputRef.value.focus()
      // ÈÄâ‰∏≠ÊâÄÊúâÊñáÊú¨ÔºåÊñπ‰æøÁî®Êà∑Âø´ÈÄü‰øÆÊîπ
      fileNameInputRef.value.select()
    }
  })
}

// Âà†Èô§Êñá‰ª∂Â§πÔºàÂÆûÈôÖ‰∏äÊòØÂà†Èô§ËØ•Êñá‰ª∂Â§π‰∏ãÁöÑÊâÄÊúâÊñá‰ª∂Ôºâ
const deleteFolder = async (folder: any) => {
  try {
    await message.delConfirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Êñá‰ª∂Â§π "${folder.name}" ÂèäÂÖ∂ÊâÄÊúâÂÜÖÂÆπÂêóÔºü`)

    // ÊâæÂà∞ËØ•Êñá‰ª∂Â§π‰∏ãÁöÑÊâÄÊúâÊñá‰ª∂
    const filesToDelete = personalFiles.value.filter(file => {
      const fileDir = file.dir || ''
      return fileDir === folder.path || fileDir.startsWith(folder.path + '/')
    })

    // ÊâπÈáèÂà†Èô§Êñá‰ª∂
    for (const file of filesToDelete) {
      await FileApi.deleteFile(file.id)
    }

    message.success('Êñá‰ª∂Â§πÂà†Èô§ÊàêÂäüÔºÅ')
    refreshPersonalFiles()
    hideContextMenu()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('Âà†Èô§Êñá‰ª∂Â§πÂ§±Ë¥•:', error)
      message.error('Âà†Èô§Êñá‰ª∂Â§πÂ§±Ë¥•')
    }
  }
}

// ‰∏™‰∫∫Êñá‰ª∂‰∏ä‰º†ÊàêÂäüÂõûË∞É
const handleUploadSuccess = (result, file) => {
  console.log('Êñá‰ª∂‰∏ä‰º†ÊàêÂäü:', result, file)
  message.success('Êñá‰ª∂‰∏ä‰º†ÊàêÂäüÔºÅ')

  // ÈáçÁΩÆ‰∏ä‰º†ÁªÑ‰ª∂ÔºåÊ∏ÖÁ©∫Êñá‰ª∂ÂàóË°®
  if (uploadFileRef.value && uploadFileRef.value.resetComponent) {
    uploadFileRef.value.resetComponent()
  }

  uploadVisible.value = false
  refreshPersonalFiles()
}

// ‰∏™‰∫∫Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•ÂõûË∞É
const handleUploadError = (error, file) => {
  console.error('Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•:', error, file)
  message.error('Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•')
}

// Â§ÑÁêÜÂÖ¨ÂÖ±Êñá‰ª∂‰∏ä‰º†
const handlePublicUpload = () => {
  publicUploadVisible.value = true
}

// ÂÖ¨ÂÖ±Êñá‰ª∂‰∏ä‰º†ÊàêÂäüÂõûË∞É
const handlePublicUploadSuccess = async (result, file) => {
  try {
    const fileId = result?.id
    if (fileId) {
      // Ë∞ÉÁî®ËÆæÁΩÆ‰∏∫ÂÖ¨ÂÖ±Êñá‰ª∂ÁöÑÊñπÊ≥ï
      await FileApi.setFilePublic(fileId)

      // Ê†áËÆ∞Êñá‰ª∂‰∏∫Â∑≤‰øùÂ≠òÁä∂ÊÄÅÔºåÈò≤Ê≠¢Ë¢´Ëá™Âä®Âà†Èô§
      if (publicUploadRef.value && publicUploadRef.value.markFilesAsSaved) {
        publicUploadRef.value.markFilesAsSaved()
      }

      message.success('ÂÖ¨ÂÖ±Êñá‰ª∂‰∏ä‰º†Âπ∂ËÆæÁΩÆÊàêÂäüÔºÅ')
      refreshPublicFiles() // Âà∑Êñ∞ÂÖ¨ÂÖ±Êñá‰ª∂ÂàóË°®
    } else {
      message.error('Êñá‰ª∂IDËé∑ÂèñÂ§±Ë¥•')
    }
  } catch (error) {
    console.error('ËÆæÁΩÆÂÖ¨ÂÖ±Êñá‰ª∂Â§±Ë¥•:', error)
    message.error('ËÆæÁΩÆÂÖ¨ÂÖ±Êñá‰ª∂Â§±Ë¥•')
  }

  // ÈáçÁΩÆ‰∏ä‰º†ÁªÑ‰ª∂ÔºåÊ∏ÖÁ©∫Êñá‰ª∂ÂàóË°®
  if (publicUploadRef.value && publicUploadRef.value.resetComponent) {
    publicUploadRef.value.resetComponent()
  }

  publicUploadVisible.value = false
}

// ÂÖ¨ÂÖ±Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•ÂõûË∞É
const handlePublicUploadError = (error, file) => {
  console.error('ÂÖ¨ÂÖ±Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•:', error, file)
  message.error('ÂÖ¨ÂÖ±Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•')
}

// È¢ÑËßàÊñá‰ª∂
const previewFile = async (file) => {
  try {
    console.log('È¢ÑËßàÊñá‰ª∂:', file)
    hideContextMenu() // ÈöêËóèÂè≥ÈîÆËèúÂçï

    // Ê∑ªÂä†Áî®Êà∑ÊòµÁß∞ÂèÇÊï∞
    const nickname = userStore.getUser?.nickname || ''
    // Âà§Êñ≠ÊòØÂê¶‰∏∫ÈùôÊÄÅÊñá‰ª∂
    if (file.configId === 0) {
      // ÈùôÊÄÅÊñá‰ª∂È¢ÑËßà
      if (file.type && file.type.includes('image')) {
        // ÈùôÊÄÅÂõæÁâáÊñá‰ª∂Ôºö‰ΩøÁî®Áé∞ÊúâÁöÑgetStaticImageUrlÊñπÊ≥ïÔºàÂú®Ê®°Êùø‰∏≠Â∑≤Â§ÑÁêÜÔºâ
        // ËøôÈáå‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÂ§ÑÁêÜÔºåÂõ†‰∏∫ÂõæÁâáÈ¢ÑËßàÂú®Ê®°Êùø‰∏≠Â∑≤ÁªèÈÄöËøágetStaticImageUrlÂ§ÑÁêÜ‰∫Ü
        return
      } else {
        // ÈùôÊÄÅÈùûÂõæÁâáÊñá‰ª∂ÔºöÊãºÊé•È¢ÑËßàÂú∞ÂùÄ
        const staticFileUrl = `${file.url}` + `?nickname=${nickname}`
        const encodedUrl = encodeURIComponent(base64Encode(staticFileUrl))
        const previewUrl = `${FIXED_DOMAIN}/preview/onlinePreview?url=${encodedUrl}`
        window.open(previewUrl, '_blank')
      }
    } else {
      // ÊôÆÈÄöÊñá‰ª∂È¢ÑËßà - ‰∏çËÉΩ‰øÆÊîπÁ≠æÂêçURLÁöÑÊü•ËØ¢ÂèÇÊï∞ÔºåÂê¶Âàô‰ºöÁ†¥ÂùèÁ≠æÂêç
      const signedUrl = await FileApi.getDownloadUrl(file.id)
      // ÊûÑÂª∫Êñá‰ª∂ËÆøÈóÆURLÔºå‰øùÊåÅÁ≠æÂêçÂÆåÊï¥ÊÄß
      const fileUrl = signedUrl + `&nickname=${nickname}`

      // ÊûÑÂª∫È¢ÑËßàURLÔºåÂ∞ÜnickName‰Ωú‰∏∫È¢ÑËßàÊúçÂä°ÁöÑÂèÇÊï∞ËÄå‰∏çÊòØÊñá‰ª∂URLÁöÑÂèÇÊï∞
      const encodedUrl = encodeURIComponent(base64Encode(fileUrl))
      let previewUrl = `${FIXED_DOMAIN}/preview/onlinePreview?url=${encodedUrl}`
      window.open(previewUrl, '_blank')
    }
  } catch (error) {
    console.error('È¢ÑËßàÊñá‰ª∂Â§±Ë¥•:', error)
    message.error('È¢ÑËßàÊñá‰ª∂Â§±Ë¥•')
  }
}

// ‰∏ãËΩΩÊñá‰ª∂
const downloadFile = async (file) => {
  try {
    console.log('‰∏ãËΩΩÊñá‰ª∂:', file)
    hideContextMenu() // ÈöêËóèÂè≥ÈîÆËèúÂçï

    // Âà§Êñ≠ÊòØÂê¶‰∏∫ÈùôÊÄÅÊñá‰ª∂
    if (file.configId === 0) {
      // ÈùôÊÄÅÊñá‰ª∂‰∏ãËΩΩÔºö
      const staticDownloadUrl = `${file.url}`
      window.open(staticDownloadUrl, '_blank')
    } else {
      // ÊôÆÈÄöÊñá‰ª∂‰∏ãËΩΩÔºöËé∑ÂèñÁ≠æÂêçÂú∞ÂùÄÂπ∂ÊõøÊç¢ÂüüÂêçÔºå‰øùÊåÅÁ≠æÂêçÂÆåÊï¥ÊÄß
      const signedUrl = await FileApi.getDownloadUrl(file.id)
      const downloadUrl = `${signedUrl}`
      window.open(downloadUrl, '_blank')
    }
  } catch (error) {
    console.error('Ëé∑Âèñ‰∏ãËΩΩÂú∞ÂùÄÂ§±Ë¥•:', error)
    message.error('Ëé∑Âèñ‰∏ãËΩΩÂú∞ÂùÄÂ§±Ë¥•')
  }
}

// ÂàÜ‰∫´Êñá‰ª∂
const shareFile = (file) => {
  hideContextMenu() // ÈöêËóèÂè≥ÈîÆËèúÂçï
  shareForm.value = {
    fileId: file.id,
    userId: '',
    permission: 1,
    expiredTime: ''
  }
  shareVisible.value = true
}

// Á°ÆËÆ§ÂàÜ‰∫´
const confirmShare = async () => {
  try {
    console.log('ÂàÜ‰∫´Êñá‰ª∂:', shareForm.value)
    await FileApi.shareFile(shareForm.value)
    message.success('Êñá‰ª∂ÂàÜ‰∫´ÊàêÂäüÔºÅ')
    shareVisible.value = false
  } catch (error) {
    console.error('Êñá‰ª∂ÂàÜ‰∫´Â§±Ë¥•:', error)
    message.error('Êñá‰ª∂ÂàÜ‰∫´Â§±Ë¥•')
  }
}

// ËÆæÁΩÆÊñá‰ª∂‰∏∫ÂÖ¨ÂÖ±Êñá‰ª∂
const setFileAsPublic = async (file) => {
  try {
    hideContextMenu() // ÈöêËóèÂè≥ÈîÆËèúÂçï
    await message.delConfirm('Á°ÆÂÆöË¶ÅÂ∞ÜÊ≠§Êñá‰ª∂ËÆæÁΩÆ‰∏∫ÂÖ¨ÂÖ±Êñá‰ª∂ÂêóÔºü')

    // Ë∞ÉÁî®ËÆæÁΩÆ‰∏∫ÂÖ¨ÂÖ±Êñá‰ª∂ÁöÑÊñπÊ≥ï
    await FileApi.setFilePublic(file.id)
    message.success('Êñá‰ª∂Â∑≤ËÆæÁΩÆ‰∏∫ÂÖ¨ÂÖ±Êñá‰ª∂ÔºÅ')

    // Âà∑Êñ∞‰∏§‰∏™ÂàóË°®
    refreshPersonalFiles()
    refreshPublicFiles()

  } catch (error) {
    if (error !== 'cancel') {
      console.error('ËÆæÁΩÆÂÖ¨ÂÖ±Êñá‰ª∂Â§±Ë¥•:', error)
      message.error('ËÆæÁΩÆÂÖ¨ÂÖ±Êñá‰ª∂Â§±Ë¥•')
    }
  }
}

// Âà†Èô§Êñá‰ª∂
const deleteFile = async (file) => {
  try {
    hideContextMenu() // ÈöêËóèÂè≥ÈîÆËèúÂçï
    await message.delConfirm()
    console.log('Âà†Èô§Êñá‰ª∂:', file)
    await FileApi.deleteFile(file.id)
    message.success('Êñá‰ª∂Âà†Èô§ÊàêÂäüÔºÅ')
    refreshPersonalFiles()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('Âà†Èô§Êñá‰ª∂Â§±Ë¥•:', error)
      message.error('Âà†Èô§Êñá‰ª∂Â§±Ë¥•')
    }
  }
}

// ÂàáÊç¢ÈÄâÊã©Ê®°Âºè
const toggleSelectMode = () => {
  isSelectMode.value = !isSelectMode.value
  if (!isSelectMode.value) {
    selectedFiles.value = []
  }
}

// Ê£ÄÊü•Êñá‰ª∂ÊòØÂê¶Ë¢´ÈÄâ‰∏≠
const isFileSelected = (file: any) => {
  return selectedFiles.value.some(f => f.id === file.id)
}

// ÂàáÊç¢Êñá‰ª∂ÈÄâÊã©Áä∂ÊÄÅ
const toggleFileSelection = (file: any) => {
  const index = selectedFiles.value.findIndex(f => f.id === file.id)
  if (index > -1) {
    selectedFiles.value.splice(index, 1)
  } else {
    selectedFiles.value.push(file)
  }
}

// Â§ÑÁêÜÊñá‰ª∂ÁÇπÂáª
const handleFileClick = (file: any, index: number, event: MouseEvent) => {
  if (!isSelectMode.value) return

  if (event.ctrlKey || event.metaKey) {
    // Ctrl/Cmd + ÁÇπÂáªÔºöÂàáÊç¢ÈÄâ‰∏≠Áä∂ÊÄÅ
    toggleFileSelection(file)
    lastSelectedIndex.value = index
  } else if (event.shiftKey && lastSelectedIndex.value !== -1) {
    // Shift + ÁÇπÂáªÔºöËåÉÂõ¥ÈÄâÊã©
    const start = Math.min(lastSelectedIndex.value, index)
    const end = Math.max(lastSelectedIndex.value, index)
    const filesToSelect = currentFiles.value.slice(start, end + 1)

    // Ê∏ÖÁ©∫ÂΩìÂâçÈÄâÊã©
    selectedFiles.value = []
    // Ê∑ªÂä†ËåÉÂõ¥ÂÜÖÁöÑÊñá‰ª∂
    filesToSelect.forEach(f => {
      if (!isFileSelected(f)) {
        selectedFiles.value.push(f)
      }
    })
  } else {
    // ÊôÆÈÄöÁÇπÂáªÔºöÂçïÈÄâ
    selectedFiles.value = [file]
    lastSelectedIndex.value = index
  }
}

// ÂÖ®ÈÄâ
const selectAll = () => {
  selectedFiles.value = [...currentFiles.value]
}

// Ê∏ÖÁ©∫ÈÄâÊã©
const clearSelection = () => {
  selectedFiles.value = []
}

// ÊâπÈáè‰∏ãËΩΩ
const bulkDownload = async () => {
  try {
    for (const file of selectedFiles.value) {
      await downloadFile(file)
    }
    message.success(`ÂºÄÂßã‰∏ãËΩΩ ${selectedFiles.value.length} ‰∏™Êñá‰ª∂`)
  } catch (error) {
    message.error('ÊâπÈáè‰∏ãËΩΩÂ§±Ë¥•')
  }
}

// ÊâπÈáèÁßªÂä®
const bulkMove = () => {
  if (selectedFiles.value.length === 0) return

  // ‰ΩøÁî®Á¨¨‰∏Ä‰∏™Êñá‰ª∂‰Ωú‰∏∫ÁõÆÊ†áÔºåÊòæÁ§∫ÁßªÂä®ÂØπËØùÊ°Ü
  moveFileTarget.value = {
    id: 'bulk',
    files: selectedFiles.value,
    name: `${selectedFiles.value.length} ‰∏™Êñá‰ª∂`
  }
  moveForm.value.targetDir = ''
  moveDialogVisible.value = true
}

// ÊâπÈáèËÆæ‰∏∫ÂÖ¨ÂÖ±
const bulkSetPublic = async () => {
  try {
    await message.delConfirm(`Á°ÆÂÆöË¶ÅÂ∞ÜÈÄâ‰∏≠ÁöÑ ${selectedFiles.value.length} ‰∏™Êñá‰ª∂ËÆæÁΩÆ‰∏∫ÂÖ¨ÂÖ±Êñá‰ª∂ÂêóÔºü`)

    for (const file of selectedFiles.value) {
      await FileApi.setFilePublic(file.id)
    }

    message.success('ÊâπÈáèËÆæ‰∏∫ÂÖ¨ÂÖ±Êñá‰ª∂ÊàêÂäüÔºÅ')
    refreshPersonalFiles()
    refreshPublicFiles()
    clearSelection()
  } catch (error) {
    if (error !== 'cancel') {
      message.error('ÊâπÈáèËÆæ‰∏∫ÂÖ¨ÂÖ±Êñá‰ª∂Â§±Ë¥•')
    }
  }
}

// ÊâπÈáèÂà†Èô§
const bulkDelete = async () => {
  try {
    await message.delConfirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedFiles.value.length} ‰∏™Êñá‰ª∂ÂêóÔºü`)

    for (const file of selectedFiles.value) {
      await FileApi.deleteFile(file.id)
    }

    message.success('ÊâπÈáèÂà†Èô§ÊàêÂäüÔºÅ')
    refreshPersonalFiles()
    clearSelection()
  } catch (error) {
    if (error !== 'cancel') {
      message.error('ÊâπÈáèÂà†Èô§Â§±Ë¥•')
    }
  }
}



// ÂàùÂßãÂåñ
onMounted(() => {
  getPersonalFiles()
  getPublicFiles()
})
</script>

<style scoped lang="scss">
.file-cabinet {
  .file-tabs {
    :deep(.el-tabs__content) {
      padding: 0;
    }
  }

  .toolbar {
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;

    .toolbar-left {
      display: flex;
      gap: 12px;
    }

    .toolbar-right {
      .search-container {
        display: flex;
        align-items: center;
        gap: 8px;

        .search-input {
          width: 300px;

          .search-icon {
            color: #909399;
          }
        }

        .sort-buttons {
          display: flex;
          gap: 4px;
          margin-left: 8px;

          .el-button {
            padding: 6px 8px;
            border-radius: 4px;
            min-width: 32px;

            &.is-active,
            &--primary {
              background: #409eff;
              border-color: #409eff;
              color: #fff;
            }
          }
        }

      }
    }
  }

  .bulk-actions-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding: 12px 16px;
    background: #f0f9ff;
    border: 1px solid #bae6fd;
    border-radius: 6px;

    .selected-count {
      font-size: 14px;
      color: #0369a1;
      font-weight: 500;
    }

    .bulk-actions {
      display: flex;
      gap: 8px;
    }
  }

  .breadcrumb-nav {
    margin-bottom: 16px;
    padding: 8px 12px;
    background: #f5f7fa;
    border-radius: 4px;

    .breadcrumb-item {
      cursor: pointer;
      color: #409eff;

      &:hover {
        text-decoration: underline;
      }
    }
  }

  .file-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 16px;
    padding: 20px 0;

    // ÂìçÂ∫îÂºèËÆæËÆ°
    @media (max-width: 1200px) {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 14px;
    }

    @media (max-width: 768px) {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
    }

    @media (max-width: 480px) {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
    }
  }

  .file-card {
    border: 1px solid #e4e7ed;
    border-radius: 8px;
    padding: 16px 12px;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    background: #fff;
    position: relative;
    overflow: hidden;
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;

    &:hover {
      border-color: #409eff;
      box-shadow: 0 4px 20px rgba(64, 158, 255, 0.15);
      transform: translateY(-2px);
    }

    &:active {
      transform: translateY(0);
      transition: transform 0.1s;
    }

    &.folder-card {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border: 1px solid #bae6fd;

      &:hover {
        background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
        border-color: #0ea5e9;
        box-shadow: 0 4px 20px rgba(14, 165, 233, 0.2);
      }
    }

    // Êñá‰ª∂ÈÄâ‰∏≠Áä∂ÊÄÅ
    &.selected {
      border-color: #409eff;
      background: #f0f9ff;

      &.folder-card {
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      }
    }

    .file-icon-container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex: 1;
      margin-bottom: 8px;
      position: relative;

      .file-checkbox {
        position: absolute;
        top: 8px;
        right: 8px;
        z-index: 10;

        .el-checkbox {
          margin: 0;

          :deep(.el-checkbox__input) {
            .el-checkbox__inner {
              width: 20px;
              height: 20px;
              background: rgba(255, 255, 255, 0.9);
              border: 2px solid #409eff;
              border-radius: 6px;
              box-shadow: 0 2px 8px rgba(64, 158, 255, 0.3);
              transition: all 0.2s ease;

              &:hover {
                background: #fff;
                border-color: #409eff;
                transform: scale(1.1);
              }

              &::after {
                width: 6px;
                height: 10px;
                border: 2px solid #fff;
                border-left: 0;
                border-top: 0;
                left: 6px;
                top: 2px;
              }
            }

            &.is-checked {
              .el-checkbox__inner {
                background: #409eff;
                border-color: #409eff;
              }
            }

            &.is-indeterminate {
              .el-checkbox__inner {
                background: #409eff;
                border-color: #409eff;
              }
            }
          }
        }
      }

      .file-icon {
        font-size: 88px !important;
        transition: transform 0.2s ease;
        color: #409eff !important;
        min-height: 88px;
        display: flex !important;
        align-items: center;
        justify-content: center;
        line-height: 1;
        width: 88px;
        opacity: 1 !important;
        visibility: visible !important;
      }

      .folder-icon {
        font-size: 88px;
        color: #0ea5e9;
        transition: all 0.2s ease;
        min-height: 88px;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 88px;
      }

      .file-thumbnail {
        width: 80px;
        height: 80px;
        border-radius: 8px;
        object-fit: cover;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease;

        &:hover {
          transform: scale(1.05);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
      }
    }

    &:hover .file-icon {
      transform: scale(1.1);
    }

    &:hover .folder-icon {
      transform: scale(1.1);
      color: #0284c7;
    }

    .file-info {
      text-align: center;

      .file-name {
        font-size: 13px;
        font-weight: 500;
        color: #303133;
        margin-bottom: 6px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        line-height: 1.3;
        min-height: 17px;

        // Êñá‰ª∂ÂêçËøáÈïøÊó∂ÊòæÁ§∫ tooltip
        &:hover {
          position: relative;
          z-index: 10;
        }
      }

      .file-meta {
        font-size: 11px;
        color: #909399;
        line-height: 1.3;
        min-height: 14px;

        .file-date {
          display: block;
          margin-top: 2px;
          font-size: 10px;
          opacity: 0.8;
        }
      }
    }
  }

  .search-item {
    display: flex;
    align-items: center;
    padding: 10px 0;

    .file-icon {
      font-size: 18px !important;
      margin-right: 12px;
      /* È¢úËâ≤Áî±ÂÜÖËÅîÊ†∑ÂºèÊéßÂà∂ */
    }

    .file-info {
      flex: 1;

      .file-name {
        font-size: 14px;
        color: #303133;
        margin-bottom: 4px;
        font-weight: 500;
      }

      .file-meta-row {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 11px;

        .file-path {
          color: #909399;
        }

        .file-size {
          color: #c0c4cc;
        }

        .file-time {
          color: #a8abb2;
        }
      }
    }
  }
}

.context-menu {
  position: fixed;
  z-index: 9999;
  background: #fff;
  border: 1px solid #e4e7ed;
  border-radius: 8px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  padding: 8px 0;
  min-width: 160px;
  backdrop-filter: blur(10px);

  .menu-items {
    .menu-item {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      cursor: pointer;
      font-size: 14px;
      color: #303133;
      transition: all 0.2s ease;
      position: relative;

      &:hover {
        background: #f0f9ff;
        color: #409eff;

        .menu-icon {
          transform: scale(1.1);
        }
      }

      &.danger {
        color: #f56c6c;

        &:hover {
          background: #fef0f0;
          color: #f56c6c;
        }
      }

      .menu-icon {
        margin-right: 12px;
        font-size: 16px;
        transition: transform 0.2s ease;
        width: 16px;
        display: flex;
        justify-content: center;
      }
    }

    .menu-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, #e4e7ed, transparent);
      margin: 6px 12px;
    }
  }
}

.folder-option {
  display: flex;
  align-items: center;

  .folder-icon {
    margin-right: 8px;
    font-size: 16px;
    color: #409eff;
  }
}

.move-tips,
.rename-tips {
  display: flex;
  align-items: center;
  color: #909399;
  font-size: 12px;

  .tip-icon {
    margin-right: 4px;
    color: #409eff;
  }
}



.upload-info {
  margin-bottom: 16px;

  .current-path-info {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background: #f0f9ff;
    border: 1px solid #bae6fd;
    border-radius: 4px;
    color: #0369a1;
    font-size: 14px;

    .path-icon {
      margin-right: 8px;
      font-size: 16px;
    }
  }
}
</style>
